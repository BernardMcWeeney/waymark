---
import { SITE_TITLE, PRODUCTS } from '../consts';

const pathname = Astro.url.pathname;

// Navigation structure - shallow, predictable
const navigation = {
  products: {
    label: 'Products',
    items: PRODUCTS.map(p => ({
      title: p.shortTitle,
      description: p.description.substring(0, 60) + '...',
      href: p.href,
    })),
  },
  solutions: {
    label: 'Solutions',
    items: [
      { title: 'Microsoft 365 Security', description: 'Secure your Microsoft environment', href: '/solutions/microsoft-365' },
      { title: 'Network Infrastructure', description: 'Enterprise networking solutions', href: '/solutions/networking' },
    ],
  },
  links: [
    { label: 'Services', href: '/services' },
    { label: 'About', href: '/about' },
    { label: 'Resources', href: '/blog' },
  ],
};
---

<header class="fixed top-0 left-0 right-0 z-50 bg-neutral-950/80 backdrop-blur-md border-b border-neutral-800/50" id="main-header">
  <div class="container-lg">
    <nav class="flex items-center justify-between h-16">
      <!-- Logo -->
      <a href="/" class="flex items-center gap-2.5 text-white hover:text-white">
        <div class="w-8 h-8 bg-primary-500 rounded-lg flex items-center justify-center">
          <svg class="w-5 h-5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75m-3-7.036A11.959 11.959 0 013.598 6 11.99 11.99 0 003 9.749c0 5.592 3.824 10.29 9 11.623 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.571-.598-3.751h-.152c-3.196 0-6.1-1.248-8.25-3.285z" />
          </svg>
        </div>
        <span class="text-lg font-semibold">{SITE_TITLE}</span>
      </a>

      <!-- Desktop Navigation -->
      <div class="hidden lg:flex items-center gap-1">
        <!-- Products Dropdown -->
        <div class="relative group">
          <button class="nav-link flex items-center gap-1 px-3 py-2">
            {navigation.products.label}
            <svg class="w-4 h-4 transition-transform group-hover:rotate-180" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" />
            </svg>
          </button>

          <!-- Mega Menu - Products -->
          <div class="absolute top-full left-0 pt-2 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-150">
            <div class="bg-neutral-900 border border-neutral-800 rounded-xl p-4 w-80 shadow-xl">
              <div class="space-y-1">
                {navigation.products.items.map((item) => (
                  <a href={item.href} class="block p-3 rounded-lg hover:bg-neutral-800 transition-colors">
                    <div class="text-white font-medium text-sm">{item.title}</div>
                    <div class="text-neutral-500 text-xs mt-0.5">{item.description}</div>
                  </a>
                ))}
              </div>
              <div class="border-t border-neutral-800 mt-3 pt-3">
                <a href="/products/phishing-simulation" class="text-xs text-neutral-400 hover:text-white transition-colors">
                  View all products â†’
                </a>
              </div>
            </div>
          </div>
        </div>

        <!-- Solutions Dropdown -->
        <div class="relative group">
          <button class="nav-link flex items-center gap-1 px-3 py-2">
            {navigation.solutions.label}
            <svg class="w-4 h-4 transition-transform group-hover:rotate-180" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" />
            </svg>
          </button>

          <!-- Mega Menu - Solutions -->
          <div class="absolute top-full left-0 pt-2 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-150">
            <div class="bg-neutral-900 border border-neutral-800 rounded-xl p-4 w-72 shadow-xl">
              <div class="space-y-1">
                {navigation.solutions.items.map((item) => (
                  <a href={item.href} class="block p-3 rounded-lg hover:bg-neutral-800 transition-colors">
                    <div class="text-white font-medium text-sm">{item.title}</div>
                    <div class="text-neutral-500 text-xs mt-0.5">{item.description}</div>
                  </a>
                ))}
              </div>
            </div>
          </div>
        </div>

        <!-- Simple Links -->
        {navigation.links.map((link) => (
          <a
            href={link.href}
            class:list={[
              "nav-link px-3 py-2",
              pathname === link.href || (link.href !== "/" && pathname.startsWith(link.href))
                ? "nav-link-active"
                : ""
            ]}
          >
            {link.label}
          </a>
        ))}
      </div>

      <!-- CTA -->
      <div class="hidden lg:flex items-center gap-3">
        <a href="/contact" class="btn-secondary text-sm">
          Contact Sales
        </a>
      </div>

      <!-- Mobile Menu Button -->
      <button
        class="lg:hidden p-2 text-neutral-400 hover:text-white transition-colors"
        id="mobile-menu-btn"
        aria-label="Toggle menu"
      >
        <svg class="w-6 h-6 menu-open" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
        </svg>
        <svg class="w-6 h-6 menu-close hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </nav>
  </div>

  <!-- Mobile Menu -->
  <div class="lg:hidden hidden border-t border-neutral-800" id="mobile-menu">
    <div class="container-lg py-4">
      <!-- Products Section -->
      <div class="mb-4">
        <div class="text-xs font-semibold text-neutral-500 uppercase tracking-wider px-3 mb-2">
          Products
        </div>
        {navigation.products.items.map((item) => (
          <a href={item.href} class="block px-3 py-2 text-neutral-300 hover:text-white transition-colors">
            {item.title}
          </a>
        ))}
      </div>

      <!-- Solutions Section -->
      <div class="mb-4">
        <div class="text-xs font-semibold text-neutral-500 uppercase tracking-wider px-3 mb-2">
          Solutions
        </div>
        {navigation.solutions.items.map((item) => (
          <a href={item.href} class="block px-3 py-2 text-neutral-300 hover:text-white transition-colors">
            {item.title}
          </a>
        ))}
      </div>

      <!-- Other Links -->
      <div class="border-t border-neutral-800 pt-4 mt-4">
        {navigation.links.map((link) => (
          <a href={link.href} class="block px-3 py-2 text-neutral-300 hover:text-white transition-colors">
            {link.label}
          </a>
        ))}
      </div>

      <!-- Mobile CTA -->
      <div class="mt-4 px-3">
        <a href="/contact" class="btn-primary w-full justify-center">
          Contact Sales
        </a>
      </div>
    </div>
  </div>
</header>

<!-- Spacer for fixed header -->
<div class="h-16"></div>

<script>
  const mobileMenuBtn = document.getElementById('mobile-menu-btn');
  const mobileMenu = document.getElementById('mobile-menu');
  const menuOpen = mobileMenuBtn?.querySelector('.menu-open');
  const menuClose = mobileMenuBtn?.querySelector('.menu-close');

  mobileMenuBtn?.addEventListener('click', () => {
    const isOpen = !mobileMenu?.classList.contains('hidden');

    if (isOpen) {
      mobileMenu?.classList.add('hidden');
      menuOpen?.classList.remove('hidden');
      menuClose?.classList.add('hidden');
    } else {
      mobileMenu?.classList.remove('hidden');
      menuOpen?.classList.add('hidden');
      menuClose?.classList.remove('hidden');
    }
  });
</script>
